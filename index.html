<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitur Sebar Undangan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        .note {
            font-size: 13px;
            color: #333;
            margin-bottom: 16px;
        }
        .warning {
            color: #333;
            font-weight: bold;
            margin-bottom: 16px;
        }
        .template-area {
            margin-top: 20px;
        }
        .template-selector {
            margin-bottom: 16px;
        }
        .template-selector button {
            padding: 6px 12px;
            margin-right: 8px;
            margin-bottom: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .template-selector button.active {
            box-shadow: 0 0 0 2px black;
        }
        .formal {
            background-color: #1e88e5;
            color: white;
        }
        .muslim {
            background-color: #2e7d32;
            color: white;
        }
        .nasrani {
            background-color: #757575;
            color: white;
        }
        .hindu {
            background-color: #ffb300;
            color: black;
        }
        .template-preview {
            border: 1px solid #ddd;
            padding: 16px;
            height: 200px;
            overflow-y: auto;
            background-color: white;
            font-size: 14px;
        }
        .link {
            color: #1e88e5;
            text-decoration: underline;
            cursor: pointer;
        }
        .button-group {
            margin-top: 20px;
            text-align: center;
        }
        .button-group button {
            padding: 8px 16px;
            margin: 0 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .send-button {
            background-color: #1e88e5;
            color: white;
        }
        .reset-button {
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* Guest list table styles */
        .guest-list-container {
            margin-top: 30px;
        }
        .guest-list-container h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
        }
        .guest-list-table {
            width: 100%;
            border-collapse: collapse;
        }
        .guest-list-table th {
            background-color: #222;
            color: white;
            text-align: left;
            padding: 10px;
        }
        .guest-list-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .guest-list-table tr:last-child td {
            border-bottom: none;
        }
        .option-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .option-button {
            border: none;
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
        }
        .whatsapp-button {
            background-color: #25D366;
        }
        .facebook-button {
            background-color: #1877F2;
        }
        .link-button {
            background-color: #000000;
        }
        .text-button {
            background-color: #FFC107;
            color: black;
        }
        .delete-button {
            background-color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FITUR SEBAR UNDANGAN</h1>
        
        <div class="form-group">
            <label for="guest-names">Silahkan Masukan Nama Tamu</label>
            <p class="note">* Gunakan baris baru (<kbd>â†µ</kbd>) untuk memisahkan nama yang akan Anda undang.</p>
            <textarea id="guest-names" placeholder="fadel dan partner"></textarea>
        </div>
        
        <div class="warning">
            JANGAN EDIT text [link-undangan] pada pengantar agar otomatis tercantumkan link kehalaman undangan.
        </div>
        
        <div class="warning">
            JANGAN EDIT text [nama] untuk menyertakan nama yang Anda undang.
        </div>
        
        <div class="template-area">
            <div class="template-selector">
                <label>Pilih Ucapan Text Pengantar</label>
                <div>
                    <button class="formal active">Formal</button>
                    <button class="muslim">Muslim</button>
                    <button class="nasrani">Nasrani</button>
                    <button class="hindu">Hindu</button>
                </div>
            </div>
            
            <div class="template-preview" contenteditable="true" id="template-preview">
                <span>Dengan hormat,</span>
<p>Kami berdua, Sri Handayani dan Andri Nurhadi, dengan sukacita mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami.</p>
<span>Tanggal: 01 Juni 2025</span>
<p>Waktu: 13.00 WIB</p>
<p>Kami berharap Bapak/Ibu/Saudara/i dapat hadir dan memberikan doa restu agar pernikahan kami menjadi sakinah, mawaddah, dan rahmah.</p>
<span>Informasi lebih lanjut dapat diakses melalui link: </span>
<p><span class="link">[link-undangan]</span></p>
<p>Terima kasih atas perhatian dan kehadirannya.</p>
<span>Hormat kami,</span>
<span>Sri Handayani dan Andri Nurhadi</span>`,
                
                muslim: `<p>Dengan hormat,</p>
                <p>Kami berdua, Sri Handayani dan Andri Nurhadi, dengan sukacita mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami.</p>
                <span>Tanggal: 01 Juni 2025</span>
                <p>Waktu: 13.00 WIB</p>
                <p>Kami berharap Bapak/Ibu/Saudara/i dapat hadir dan memberikan doa restu agar pernikahan kami menjadi sakinah, mawaddah, dan rahmah.</p>
                <span>Informasi lebih lanjut dapat diakses melalui link: </span>
                <p><span class="link">[link-undangan]</span></p>
                <p>Terima kasih atas perhatian dan kehadirannya.</p>
                <span>Hormat kami,</span>
                <span>Sri Handayani dan Andri Nurhadi</span>
            </div>
        </div>
        
        <div class="button-group">
            <button class="send-button">Buat Daftar Tamu</button>
            <button class="reset-button">Reset</button>
        </div>
    </div>

    <br>
    <div class="container">
        <h2>Daftar Nama Tamu</h2>
        <table class="guest-list-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Tamu</th>
                    <th>Opsi</th>
                </tr>
            </thead>
            <tbody id="guest-list-body">
                <!-- Guest entries will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Template selection functionality
            const linkUndangan = "https://by.galipatstory.com/srihay-andrin/?to="

            
            const buttons = document.querySelectorAll('.template-selector button');
            const templatePreview = document.querySelector('.template-preview');

            // Handle Enter key properly in contenteditable
            templatePreview.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    // Insert <br> tag instead of default behavior
                    e.preventDefault();
                    
                    // Insert line break
                    const selection = window.getSelection();
                    const range = selection.getRangeAt(0);
                    const br = document.createElement('br');
                    range.deleteContents();
                    range.insertNode(br);
                    
                    // Move cursor after the break
                    range.setStartAfter(br);
                    range.setEndAfter(br);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            });
            
            const templates = {
                formal: `<p>Dengan hormat,</p>
<p>Kami berdua, Sri Handayani dan Andri Nurhadi, dengan sukacita mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami.</p>
<span>Tanggal: 01 Juni 2025</span>
<p>Waktu: 13.00 WIB</p>
<p>Kami berharap Bapak/Ibu/Saudara/i dapat hadir dan memberikan doa restu agar pernikahan kami menjadi sakinah, mawaddah, dan rahmah.</p>
<span>Informasi lebih lanjut dapat diakses melalui link: </span>
<p><span class="link">[link-undangan]</span></p>
<p>Terima kasih atas perhatian dan kehadirannya.</p>
<span>Hormat kami,</span>
<span>Sri Handayani dan Andri Nurhadi</span>`,
                
                muslim: `<span>Bismillahirrahmanirrahim</span>
<p>Assalamu'alaikum Wr. Wb.</p>
<p>Dengan mengharap ridho Allah SWT, kami berdua, Sri Handayani dan Andri Nurhadi dengan sukacita mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami yang Insya Allah akan dilaksanakan pada:</p>
<span>Tanggal: 01 Juni 2025</span>
<p>Waktu: 13.00 WIB</p>
<p>Kami berharap Bapak/Ibu/Saudara/i dapat hadir dan memberikan doa restu agar pernikahan kami menjadi sakinah, mawaddah, dan rahmah.</p>
<span>Informasi lebih lanjut dapat diakses melalui link: </span>
<p><span class="link">[link-undangan]</span></p>
<p>Wassalamualaikum Wr. Wb.</p>
<span>Kami yang Berbahagia</span>
<p>Sri Handayani dan Andri Nurhadi</p>`,
                
                nasrani: `<p>Puji Tuhan,</p>
<p>Dengan sukacita kami mengundang Bapak/Ibu/Saudara/i <span class="link">[nama]</span> untuk menghadiri acara pemberkatan kami.</p>
<p>*Berikut <span class="link">link</span> undangan kami*, untuk info lengkap dari acara bisa kunjungi :</p>
<p><span class="link">[link-undangan]</span></p>
<p>Sukacita kami akan semakin lengkap dengan kehadiran dan doa restu dari Bapak/Ibu/Saudara/i.</p>
<p>Tuhan Yesus memberkati.</p>`,
                
                hindu: `<p>Om Swastiastu,</p>
<p>Dengan segala kerendahan hati, kami mengundang Bapak/Ibu/Saudara/i <span class="link">[nama]</span> untuk menghadiri acara kami.</p>
<p>*Berikut <span class="link">link</span> undangan kami*, untuk info lengkap dari acara bisa kunjungi :</p>
<p><span class="link">[link-undangan]</span></p>
<p>Merupakan suatu kehormatan bagi kami apabila Bapak/Ibu/Saudara/i berkenan untuk hadir dan memberikan doa restu.</p>
<p>Om Shanti, Shanti, Shanti, Om.</p>`
            };
            
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    buttons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update template preview based on selection
                    const templateType = this.classList[0]; // formal, muslim, nasrani or hindu
                    templatePreview.innerHTML = templates[templateType];
                });
            });
            
            // Reset button functionality
            const resetButton = document.querySelector('.reset-button');
            const guestNames = document.getElementById('guest-names');
            
            resetButton.addEventListener('click', function() {
                guestNames.value = '';
                // Reset to formal template
                buttons.forEach(btn => btn.classList.remove('active'));
                document.querySelector('.formal').classList.add('active');
                templatePreview.innerHTML = templates.formal;
            });
            
            // Send button functionality and update guest list
            const sendButton = document.querySelector('.send-button');
            const guestListBody = document.getElementById('guest-list-body');
            
            sendButton.addEventListener('click', function() {
                const names = guestNames.value.trim();
                if (!names) {
                    alert('Silahkan masukkan nama tamu terlebih dahulu!');
                    return;
                }
                
                // Clear existing guest list
                guestListBody.innerHTML = '';
                
                // Add new guests to the table
                const guestArray = names.split('\n').filter(name => name.trim() !== '');
                guestArray.forEach((name, index) => {
                    const row = document.createElement('tr');
                    
                    // Number column
                    const numCell = document.createElement('td');
                    numCell.textContent = index + 1;
                    row.appendChild(numCell);
                    
                    // Name column
                    const nameCell = document.createElement('td');
                    nameCell.textContent = name.trim();
                    row.appendChild(nameCell);
                    
                    // Options column
                    const optionsCell = document.createElement('td');
                    optionsCell.className = 'option-buttons';
                    
                    // WhatsApp button
                    const whatsappBtn = document.createElement('button');
                    whatsappBtn.className = 'option-button whatsapp-button';
                    whatsappBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> Kirim';
                    optionsCell.appendChild(whatsappBtn);
                    
                    // Link button
                    const linkBtn = document.createElement('button');
                    linkBtn.className = 'option-button link-button';
                    linkBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> Link';
                    optionsCell.appendChild(linkBtn);
                    
                    // Text button
                    const textBtn = document.createElement('button');
                    textBtn.className = 'option-button text-button';
                    textBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> Text';
                    optionsCell.appendChild(textBtn);
                    
                    // Delete button
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'option-button delete-button';
                    deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>';
                    optionsCell.appendChild(deleteBtn);
                    
                    row.appendChild(optionsCell);
                    guestListBody.appendChild(row);
                    
                    // Add event listeners for buttons
                    whatsappBtn.addEventListener('click', () => {
                        // const message = getMessageForGuest(name.trim());
                    //     alert(`WhatsApp message prepared for ${name.trim()}: ${message.substring(0, 50)}...`);
                        const linkTo = `${linkUndangan}${name.trim()}`
                        const message = getMessageForGuest(name.trim(),linkTo);
                        // Create WhatsApp web API URL (wa.me)
                        const encodedMessage = encodeURIComponent(message);
                        const waURL = `https://api.whatsapp.com/send?text=${encodedMessage}`;
                        // Open WhatsApp in a new tab
                        window.open(waURL, '_blank');
                    });
                    
                    
                    linkBtn.addEventListener('click', () => {
                        const linkTo = `${linkUndangan}${name.trim()}`
                        navigator.clipboard.writeText(linkTo).then(function() {
                            alert("Copied to clipboard");
                        }, function(err) {
                            console.error("Could not copy text: ", err);
                        });
                    });
                    
                    textBtn.addEventListener('click', () => {
                        const linkTo = `${linkUndangan}${name.trim()}`
                        const message = getMessageForGuest(name.trim(),linkTo);
                        navigator.clipboard.writeText(message).then(function() {
                            alert("Copied to clipboard");
                        }, function(err) {
                            console.error("Could not copy text: ", err);
                        });
                    });
                    
                    deleteBtn.addEventListener('click', () => {
                        row.remove();
                        // Renumber the remaining rows
                        const rows = guestListBody.querySelectorAll('tr');
                        rows.forEach((row, idx) => {
                            row.cells[0].textContent = idx + 1;
                        });
                    });
                });
                
                // Show success message
                // alert('Undangan berhasil ditambahkan ke daftar tamu!');
            });
            
            // Function to get message for a specific guest
            function getMessageForGuest(guestName,linkTo) {
                const activeTemplateClass = document.querySelector('.template-selector button.active').classList[0];
                let template = templates[activeTemplateClass];
                
                // Replace [nama] with actual guest name
                template = template.replace(/<span class="link">\[nama\]<\/span>/g, guestName);
                
                // Replace [link-undangan] with a dummy link
                template = template.replace(/<span class="link">\[link-undangan\]<\/span>/g,  encodeURI(linkTo));

                    // Convert <br> and <p> tags to line breaks for plain text
                template = template.replace(/<br\s*\/?>/gi, '\n');
                template = template.replace(/<\/p><p>/gi, '\n\n');
                template = template.replace(/<p>/gi, '');
                template = template.replace(/<\/p>/gi, '\n');
                
                // Strip remaining HTML tags for plain text
                let plainText = template.replace(/<[^>]*>/g, '');
                
                // Remove tabs specifically while preserving line breaks
                plainText = plainText.replace(/\t/g, '');
                
                // Fix any HTML entities
                plainText = plainText.replace(/&nbsp;/g, ' ');
                
                // Strip HTML tags for plain text
                return plainText;
            }
        });
    </script>
</body>
</html>